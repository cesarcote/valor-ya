<app-valorya-description></app-valorya-description>
<app-stepper></app-stepper>

<div class="step-container">
  @if (isLoading()) {
  <div class="loading-simple">
    <p>Cargando información del predio...</p>
  </div>
  } @else if (errorMessage()) {
  <div class="no-data-section">
    <h3>No se encontró información</h3>
    <p class="error-message">{{ errorMessage() }}</p>
  </div>

  <div class="confirmation-section">
    <p class="confirmation-question">
      ¿La información que reposa en nuestro sistema de información es la correcta?
    </p>
    <div class="action-buttons">
      <app-button text="Volver" variant="secondary" type="button" (clicked)="onVolver()">
      </app-button>
      <app-button
        text="No es correcta"
        variant="secondary"
        type="button"
        (clicked)="onNoEsCorrecta()"
      >
      </app-button>
      <app-button text="Continuar" variant="primary" type="button" (clicked)="onContinuar()">
      </app-button>
    </div>
  </div>
  } @else if (predioData()) {

  <div class="map-section">
    <h3>Ubicación del Predio</h3>
    <app-map></app-map>
  </div>

  <app-predio-info-card
    [predioData]="predioData()"
    [showMessage]="true"
    [showAllFields]="true"
    [tipoUnidadSeleccionada]="stateService.tipoUnidadSeleccionada()"
  >
  </app-predio-info-card>

  <div class="confirmation-section">
    <p class="confirmation-question">
      ¿La información que reposa en nuestro sistema de información es la correcta?
    </p>
    <div class="action-buttons">
      <app-button text="Volver" variant="secondary" type="button" (clicked)="onVolver()">
      </app-button>
      <app-button
        text="No es correcta"
        variant="secondary"
        type="button"
        (clicked)="onNoEsCorrecta()"
      >
      </app-button>
      <app-button
        text="Continuar"
        variant="primary"
        type="button"
        [disabled]="isValidatingAvailability() || isProcessingMCM()"
        (clicked)="onContinuar()"
      >
        @if (isValidatingAvailability()) {
        <span>Validando disponibilidad...</span>
        } @else if (isProcessingMCM()) {
        <span>Procesando datos...</span>
        } @else {
        <span>Continuar</span>
        }
      </app-button>
    </div>
  </div>
  }
</div>

@if (showModal()) {
<app-modal
  [message]="modalMessage()"
  [title]="modalTitle()"
  [iconType]="modalIconType()"
  [buttonText]="modalButtonText()"
  (close)="onCloseModal()"
>
</app-modal>
}
