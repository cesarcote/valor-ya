<app-valorya-description></app-valorya-description>
<app-stepper></app-stepper>

<div class="step-container">
  @if (resultadoPrincipal && metadatos) {
  <div class="result-section">
    <!-- Resumen del Avalúo -->
    <div class="info-section">
      <h3 class="section-title">Resumen del Avalúo</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Ofertas Utilizadas:</span>
          <span class="info-value">{{ formatInteger(metadatos.ofertas_utilizadas) }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Ofertas Válidas:</span>
          <span class="info-value">{{ metadatos.chips_procesados }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Coeficiente de Variación (CV):</span>
          <span class="info-value">{{ formatNumber(resultadoPrincipal.CV) }}%</span>
        </div>
        <div class="info-item">
          <span class="info-label">Límite Inferior:</span>
          <span class="info-value">{{ formatCurrency(resultadoPrincipal.LIM_INFERIOR) }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Límite Superior:</span>
          <span class="info-value">{{ formatCurrency(resultadoPrincipal.LIM_SUPERIOR) }}</span>
        </div>
      </div>
    </div>

    <div class="info-section highlight-section">
      <h3 class="section-title">Valoración Final</h3>
      <div class="valuation-grid">
        <div class="valuation-item primary">
          <span class="valuation-label">Valor YA</span>
          <span class="valuation-value">{{
            formatCurrency(resultadoPrincipal.VALOR_AVALUO_PREDIO)
          }}</span>
        </div>
        <div class="valuation-item">
          <span class="valuation-label">Valor YA por m²</span>
          <span class="valuation-value">{{ formatCurrency(resultadoPrincipal.MEDIA) }}</span>
        </div>
      </div>
    </div>

    <div class="actions-section">
      <app-button
        text="Nueva Consulta"
        variant="secondary"
        type="button"
        (clicked)="onNuevaConsulta()"
      >
      </app-button>
      <app-button
        [text]="isDownloading() ? 'Generando PDF...' : 'Descargar Avalúo'"
        variant="primary"
        type="button"
        [disabled]="isDownloading()"
        (clicked)="onDescargarAvaluo()"
      >
      </app-button>
    </div>
  </div>
  } @else {
  <div class="result-section">
    <div class="success-header">
      <p class="result-subtitle">Cargando resultados...</p>
    </div>
  </div>
  }
</div>
